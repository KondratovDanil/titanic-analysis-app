import streamlit as st
import pandas as pd

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.set_page_config(
    page_title="–î–∞–Ω–Ω—ã–µ –¢–∏—Ç–∞–Ω–∏–∫–∞",
    page_icon="üö¢",
    layout="wide"
)

st.image("/Users/danil/Downloads/20171101163229afd9225097.jpg", caption="–ë–∞–Ω–Ω–µ—Ä", use_container_width=True)

# –ó–∞–≥–æ–ª–æ–≤–æ–∫
st.title("üö¢ –î–∞–Ω–Ω—ã–µ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –¢–∏—Ç–∞–Ω–∏–∫–∞")

st.markdown("""
–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –ø–æ —Å–ø–∞—Å–µ–Ω–Ω—ã–º –∏–ª–∏ –ø–æ–≥–∏–±—à–∏–º, –≤—ã–±–µ—Ä–∏—Ç–µ
—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø—É–Ω–∫—Ç –∏–∑ —Å–ø–∏—Å–∫–∞:
""")

# –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV
uploaded_file = st.file_uploader("üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª Titanic CSV", type=["csv"])

if uploaded_file is not None:
    df = pd.read_csv(uploaded_file)

    # –ü—Ä–æ–≤–µ—Ä–∏–º, –∫–∞–∫–∏–µ —Å—Ç–æ–ª–±—Ü—ã –µ—Å—Ç—å –≤ —Ñ–∞–π–ª–µ
    st.write("–°—Ç–æ–ª–±—Ü—ã –≤ —Ñ–∞–π–ª–µ:", list(df.columns))

    # –§–∏–ª—å—Ç—Ä –ø–æ Survived
    survived_option = st.selectbox(
        "**–ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—è Survived:**",
        ["–õ—é–±–æ–µ", "–°–ø–∞—Å–µ–Ω–Ω—ã–µ (1)", "–ü–æ–≥–∏–±—à–∏–µ (0)"],
        index=0
    )

    # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
    if survived_option == "–°–ø–∞—Å–µ–Ω–Ω—ã–µ (1)":
        df = df[df["Survived"] == 1]
        st.subheader("üìä –î–∞–Ω–Ω—ã–µ –ø–æ —Å–ø–∞—Å–µ–Ω–Ω—ã–º –ø–∞—Å—Å–∞–∂–∏—Ä–∞–º")
    elif survived_option == "–ü–æ–≥–∏–±—à–∏–µ (0)":
        df = df[df["Survived"] == 0]
        st.subheader("üìä –î–∞–Ω–Ω—ã–µ –ø–æ –ø–æ–≥–∏–±—à–∏–º –ø–∞—Å—Å–∞–∂–∏—Ä–∞–º")
    else:
        st.subheader("üìä –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–∞—Å—Å–∞–∂–∏—Ä–∞–º")

    st.markdown("---")

    # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –º—É–∂—á–∏–Ω
    males = df[df["Sex"] == "male"]

    # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–ª–∞—Å—Å—É
    stats = males.groupby("Pclass").agg(
        –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ_–≤—ã–∂–∏–≤—à–∏—Ö=("Survived", "sum"),
        –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π_–≤–æ–∑—Ä–∞—Å—Ç=("Age", "min"),
        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π_–≤–æ–∑—Ä–∞—Å—Ç=("Age", "max")
    ).reset_index()

    # –ü–µ—Ä–µ–∏–º–µ–Ω—É–µ–º —Å—Ç–æ–ª–±–µ—Ü –∫–ª–∞—Å—Å–∞ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
    stats["–ö–ª–∞—Å—Å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è"] = stats["Pclass"].map({1: "1 –∫–ª–∞—Å—Å", 2: "2 –∫–ª–∞—Å—Å", 3: "3 –∫–ª–∞—Å—Å"})
    stats = stats[["–ö–ª–∞—Å—Å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è", "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ_–≤—ã–∂–∏–≤—à–∏—Ö", "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π_–≤–æ–∑—Ä–∞—Å—Ç", "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π_–≤–æ–∑—Ä–∞—Å—Ç"]]

    # –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
    st.dataframe(stats, use_container_width=True, hide_index=True)

    # –ü–æ–¥ —Ç–∞–±–ª–∏—Ü–µ–π
    st.markdown("---")
    st.markdown("""
    **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**
    - –ü–æ–∫–∞–∑–∞–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∂–∏–≤—à–∏—Ö –º—É–∂—á–∏–Ω –ø–æ –∫–∞–∂–¥–æ–º—É –∫–ª–∞—Å—Å—É –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.
    - –£–∫–∞–∑–∞–Ω—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç –¥–ª—è –º—É–∂—á–∏–Ω –¥–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞.
    """)

    # –†–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–µ–∫—Ü–∏—è ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
    with st.expander("üìà –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"):
        for _, row in stats.iterrows():
            st.metric(
                f"{row['–ö–ª–∞—Å—Å –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è']}",
                f"{row['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ_–≤—ã–∂–∏–≤—à–∏—Ö']} —á–µ–ª–æ–≤–µ–∫",
                f"–í–æ–∑—Ä–∞—Å—Ç: {int(row['–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π_–≤–æ–∑—Ä–∞—Å—Ç'])}‚Äì{int(row['–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π_–≤–æ–∑—Ä–∞—Å—Ç'])} –ª–µ—Ç"
            )
else:
    st.info("üëÜ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª Titanic CSV, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∞–Ω–∞–ª–∏–∑.")
